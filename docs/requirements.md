# TikTok数据上传系统 - Requirements Document

开发一个用于每日上传TikTok数据Excel文件到数据库的Web系统，支持大批量数据处理和进度监控。使用Next.js + PostgreSQL技术栈，实现Excel文件解析、数据映射、分批插入等核心功能。

## Core Features

### 1. Excel文件上传和解析
- 支持.xlsx和.xls格式文件上传
- 文件大小限制50MB
- 自动识别中英文列名并映射到数据库字段
- 支持34个TikTok数据字段的完整映射

### 2. 数据处理和验证
- 智能数据类型转换（数值、布尔、日期、字符串）
- 日期格式标准化处理（2025-09-07 05:27:12）
- 数值字段自动清洗（移除非数字字符）
- 字符串字段trim处理

### 3. 大批量数据插入
- 分批处理机制（500行/批次）
- 允许重复work_id数据插入（同博主不同时间采集）
- 数据追加到现有tiktok_videos_raw表
- 自动设置created_at和updated_at时间戳

### 4. 进度监控和反馈
- 实时显示上传进度百分比
- 处理结果统计（成功插入行数、耗时）
- 错误时立即停止整个上传过程
- 详细的错误信息反馈

## User Stories

### 作为数据分析师，我希望能够：
- 快速上传Excel文件到系统，以便每日更新TikTok数据
- 看到实时上传进度，以便了解处理状态
- 在上传完成后看到详细结果，以便确认数据已正确导入
- 当出现错误时立即停止上传，以便保护数据完整性

### 作为系统用户，我希望：
- 系统能自动识别Excel中的中英文列名，无需手动配置映射关系
- 系统能处理大量数据（几千行）而不会崩溃或超时
- 系统允许相同博主的重复数据（因为是不同时间采集的更新数据）
- 界面简洁易用，专注于核心上传功能

## Acceptance Criteria

### 文件上传功能
- [x] 支持选择.xlsx和.xls格式文件
- [x] 文件大小不超过50MB时能正常上传
- [x] 超过大小限制时显示明确错误提示
- [x] 文件格式不正确时显示错误信息

### 数据解析功能
- [x] 能正确识别并映射所有34个TikTok数据字段
- [x] 支持中英文混合的列名自动匹配
- [x] 数值字段能正确处理和转换（去除非数字字符）
- [x] 日期字段能解析标准格式（2025-09-07 05:27:12）
- [x] 布尔字段能正确转换为true/false

### 数据插入功能
- [x] 大量数据（几千行）能分批处理不会超时
- [x] 每批次处理500行数据
- [x] 允许重复work_id的数据插入
- [x] 自动设置created_at和updated_at字段
- [x] 插入到正确的tiktok_videos_raw表

### 用户体验功能
- [x] 显示实时上传进度百分比
- [x] 上传完成后显示成功插入的行数
- [x] 显示整个处理过程的耗时
- [x] 遇到错误时立即停止并显示详细错误信息
- [x] 界面简洁，操作流程清晰

### 错误处理功能
- [x] 数据库连接失败时有明确提示
- [x] Excel文件损坏或格式错误时能正确处理
- [x] 必填字段缺失时有具体错误信息
- [x] 数据类型转换失败时能定位到具体行列

## Non-functional Requirements

### 性能要求
- 系统能在2分钟内处理5000行TikTok数据
- 文件上传响应时间不超过3秒
- 分批处理每批500行数据的插入时间不超过10秒
- 内存使用不超过512MB（处理50MB Excel文件）

### 可靠性要求
- 数据完整性：遇到任何错误都要停止处理，避免部分数据插入
- 错误恢复：系统崩溃后重启不会影响数据库数据完整性
- 连接稳定：数据库连接超时要有重试机制

### 兼容性要求
- 支持Windows 10+本地环境
- 兼容主流浏览器（Chrome、Firefox、Edge）
- 支持Excel 2007+格式（.xlsx）和旧版格式（.xls）

### 用户体验要求
- 界面响应时间不超过200ms
- 进度反馈实时更新（至少每秒更新一次）
- 错误信息要具体明确，帮助用户快速定位问题

### 维护性要求
- 代码结构清晰，便于后续添加可视化功能
- 使用TypeScript提供类型安全
- 关键操作有详细日志记录

### 安全要求
- 文件上传有大小和格式限制
- 数据库连接使用环境变量配置
- 不在日志中记录敏感数据库信息
